<% address_id = address_type.chars.first %>

<% ADDRESS_FIELDS.each do |field| %>
  <% if field == "country" %>
     <%= address_form.hidden_field :country_id, :value=>Spree::Country.find(Spree::Config[:default_country_id]).id %>

  <% elsif field == "state" %>
    <%= address_field(address_form, :state, address_id) { address_state(address_form, address.country, address_id) } if Spree::Config[:address_requires_state] %>
  <% else %>
    <% next if field == "company" && !Spree::Config[:company] %>
    <% next if field == "alternative_#{address_id}_phone" && !Spree::Config["alternative_#{address_id}_phone"] %>
    <%= address_field(address_form, field.to_sym, address_id) %>
  <% end %>
  <%= address_form.hidden_field :user_id %>
<% end %>